<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.zhiyun.dao.impl.ProdBomPlmDaoImpl">
    <select id="searchForProduct"  resultMap="searchMap" parameterType="map">
        SELECT
        product_store_plm.id id,
        product_store_plm.prod_name prodName,
        product_store_plm.prod_no prodNo,
        product_mid_plm.id midProductId,
        product_mid_plm.mid_prod_name midProdName,
        product_mid_plm.mid_prod_no midProdNo
        FROM
        product_store_plm
        LEFT JOIN product_mid_plm ON product_store_plm.prod_no = product_mid_plm.prod_no
        AND product_mid_plm.deleted = 'F'
        WHERE
        product_store_plm.company_id = #{companyId}
        AND product_store_plm.deleted = 'F'
        AND product_store_plm.prod_name=#{productName}
        <if test="bomCode!=null and bomCode!= '' ">
            OR product_mid_plm.mid_prod_no = #{bomCode}
        </if>
    </select>
    <resultMap id="searchMap" type="com.zhiyun.dto.ProductStorePlmDto">
        <id javaType="long" column="id" property="id"/>
        <result column="prodName" property="prodName"/>
        <result column="prodNo" property="prodNo"/>
        <collection property="midProducts" ofType="com.zhiyun.entity.ProductMidPlm" javaType="ArrayList">
            <id column="midProductId" javaType="long" property="id"/>
            <result column="midProdName" property="midProdName"/>
            <result column="midProdNo" property="midProdNo"/>
        </collection>
    </resultMap>

    <select id="findBomByPno" parameterType="map" resultType="com.zhiyun.entity.ProdBomPlm">
        SELECT
               prod_bom_plm.bom_no AS bomNo,
               prod_bom_plm.versions,
               prod_bom_plm.make_emp AS makeEmp,
               prod_bom_plm.bom_status AS bomStatus,
               prod_bom_plm.`status`,
               prod_bom_plm.make_date AS makeDate,
               voucher_main_oa.is_finished voucherStatus
        FROM
             prod_bom_plm
                 INNER JOIN voucher_main_oa ON voucher_main_oa.voucher_no = prod_bom_plm.voucher_no
                                                   AND voucher_main_oa.deleted = 'F'
        WHERE
                prod_bom_plm.deleted = 'F'
          AND prod_bom_plm.company_id =1
    </select>
    <select id="findBomByMpno" parameterType="map" resultType="com.zhiyun.entity.ProdBomPlm">
        SELECT
               prod_bom_plm.bom_no AS bomNo,
               prod_bom_plm.versions,
               prod_bom_plm.make_emp AS makeEmp,
               prod_bom_plm.bom_status AS bomStatus,
               prod_bom_plm.`status`,
               prod_bom_plm.make_date AS makeDate,
               voucher_main_oa.is_finished voucherStatus
        FROM
             prod_bom_plm
                 INNER JOIN voucher_main_oa ON voucher_main_oa.voucher_no = prod_bom_plm.voucher_no
                                                   AND voucher_main_oa.deleted = 'F'
        WHERE
                prod_bom_plm.deleted = 'F'
          AND prod_bom_plm.company_id =1
    </select>
</mapper>
